(()=>{"use strict";const e=(e,t)=>{let a=0,c=!1;const n=()=>e;return{hit:()=>(a++,a),isSunk:()=>a>=n()&&(c=!0,c),getLength:n,getName:()=>t,getNumberofHits:()=>a}},t=()=>{const e=[],t=()=>e,a=e=>{const a=t();let c;for(let t=0;t<a.length;t++)JSON.stringify(a[t].cord)===JSON.stringify(e)&&(c=a[t],c.isOccupied=!0)},c=[],n=e=>{const a=t();let c;for(let t=0;t<a.length;t++)if(JSON.stringify(a[t].cord)===JSON.stringify(e))return c=t,c;return!1},r=e=>{const a=t();let c;for(let t=0;t<a.length;t++)if(JSON.stringify(a[t].cord)===JSON.stringify(e))return c=a[t],!1===c.isOccupied;return!1},s=[],d=e=>{for(let t=0;t<c.length;t++)for(let a=0;a<c[t].shipCordinates.length;a++)if(JSON.stringify(c[t].shipCordinates[a])===JSON.stringify(e)){const e=c[t].shipCordinates.indexOf(c[t].shipCordinates[a]),n=c[t].shipObject;if(c[t].shipCordinates.splice(e,1),0===c[t].shipCordinates.length){c.splice(t,1);break}n.ship.hit()}return!1};return{createGameboard:()=>{for(let t=0;t<=9;t++)for(let a=0;a<=9;a++){const c={cord:[],isOccupied:!1,isAttacked:!1,isMissed:!1};c.cord[0]=t,c.cord[1]=a,e.push(c)}return e},getGameBoardArray:t,placeShip:(e,t,c)=>{const n=e(c,t);let r;!1===n&&alert("Ship Can not be placed");for(let e=0;e<n.length;e++)r=n[e],a(r);return n},checkCordinates:r,placeShipHorizontalyRight:(e,t)=>{const a=t.getLength();let c=e[1];const n=[];for(let t=0;t<a;t++){c=e[1],c+=t;const a=[e[0],c];n.push(a)}return!!n.every((e=>r(e)))&&n},placeShipHorizontalyLeft:(e,t)=>{const a=t.getLength();let c=e[1];const n=[];for(let t=a-1;t>=0;t--){c=e[1],c-=t;const a=[e[0],c];n.push(a)}return!!n.every((e=>r(e)))&&n},placeShipVerticalyUp:(e,t)=>{const a=[];for(let c=t.getLength()-1;c>=0;c--){let t=e[0];t-=c;const n=[t,e[1]];a.push(n)}return!!a.every((e=>r(e)))&&a},placeShipVerticalyDown:(e,t)=>{const a=t.getLength();let c=e[0];const n=[];for(let t=0;t<a;t++){c=e[0],c+=t;const a=[c,e[1]];n.push(a)}return!!n.every((e=>r(e)))&&n},getShipLocations:()=>c,addShipLocation:(e,t)=>{if(!1===e)return!1;const a={shipObject:t,shipCordinates:e};return c.push(a),!0},receiveAttack:e=>{const a=n(e),c=t()[a];return!0!==c.isAttacked&&(c.isAttacked=!0,d(e),!0)},allShipsSunk:()=>0===c.length,getMissedAttacks:()=>s,shipLocatedAtAttack:d,checkIfMissed:t=>{const a=n(t);return!1===e[a].isOccupied&&s.push(e[a].cord),!1}}},a=a=>{const c=[{ship:e(5,"Carrier"),placed:!1},{ship:e(4,"Battleship"),placed:!1},{ship:e(3,"Destroyer"),placed:!1},{ship:e(3,"Submarine"),placed:!1},{ship:e(2,"Patrol Boat"),placed:!1}],n=t(),r=t();n.createGameboard(),r.createGameboard();const s=n.getGameBoardArray(),d=r.getGameBoardArray(),i=n.placeShipVerticalyUp,o=n.placeShipVerticalyDown,l=n.placeShipHorizontalyRight,u=n.placeShipHorizontalyLeft,p=e=>!0===c[e].placed?(alert("Ship has been placed"),!1):c[e].ship,h=e=>!0!==s[e].isOccupied&&s[e].cord,m=e=>"up"===e?i:"down"===e?o:"right"===e?l:"left"===e&&u;return{getName:()=>a,ships:c,playersGameboard:s,attack:e=>r.receiveAttack(e),gameboardObject:n,selectShip:p,selectDirection:m,selectCordinates:h,placeShip:(e,t,a)=>{const r=p(e),s=h(a),d=m(t);return!1===c[e].placed&&!1!==r&&!1!==s&&!1!==d&&n.placeShip(d,r,s)},blankGameboard:d}},c=document.querySelector(".content"),n=(()=>{const e=a("Player 1"),t=a("Player 2");let c=e,n=t;return{getCurrentPlayer:()=>c,changeCurrentPlayer:()=>c===e?(c=t,n=e,c):(c=e,n=t,c),getEnemyPlayer:()=>n,getPlayer1:()=>e,getPlayer2:()=>t}})();(()=>{let e=n.getCurrentPlayer();const t=()=>{for(;c.hasChildNodes();)c.removeChild(c.firstChild)},a=()=>{const e=document.createElement("header");c.appendChild(e)},r=()=>{const e=document.createElement("h1");e.textContent="Battleship",c.appendChild(e)},s=a=>{a.currentTarget;const c=document.querySelectorAll(".ship"),n=document.querySelectorAll(".square"),r=document.querySelectorAll(".direction"),s=(()=>{let e;return n.forEach((t=>"true"===t.dataset.active&&(e=t.dataset.index,e))),e})(),d=(()=>{let e;return c.forEach((t=>"true"===t.dataset.active&&(e=t.dataset.index,e))),e})(),i=(()=>{let e;return r.forEach((t=>"true"===t.dataset.active&&(e=t.id,e))),e})();if(s&&d&&i){const a=e.placeShip(d,i,s);!1===e.gameboardObject.addShipLocation(a,e.ships[d]).shipCordinates&&alert("ship cannot be placed here"),e.ships[d].placed=!0,t(),v()}},d=()=>{const t=document.createElement("div");t.classList.add("ships"),document.querySelector(".monitor").appendChild(t),e.ships.forEach((a=>{const c=document.createElement("div");c.classList.add("ship"),c.dataset.active=!1,c.dataset.index=e.ships.indexOf(a),c.dataset.numberOfHits=a.ship.getNumberofHits(),c.dataset.isSunk=a.ship.isSunk();const n=document.createElement("h3");n.textContent=`${a.ship.getName()}`;const r=document.createElement("p");r.textContent=`Size = ${a.ship.getLength()}`;const s=document.createElement("button");s.textContent="Place Ship!",s.dataset.active="true",s.classList.add("hidden"),s.classList.add("place-ship"),t.appendChild(c),c.appendChild(n),c.appendChild(r),c.appendChild(s)}))},i=()=>{t(),e=n.changeCurrentPlayer(),l()},o=a=>{const c=document.querySelectorAll(".square"),r=e.blankGameboard,s=n.getEnemyPlayer(),d=n.getEnemyPlayer().playersGameboard;let u;e.playersGameboard,s.ships;for(let a=0;a<r.length;a++)if("true"===c[a].dataset.active&&!1===r[a].isAttacked){s.gameboardObject.checkIfMissed(d[a].cord),u=r[a],s.gameboardObject.receiveAttack(d[a].cord),e.attack(u.cord),s.gameboardObject.getMissedAttacks().forEach((e=>{JSON.stringify(r[a].cord)===JSON.stringify(e)&&(r[a].isMissed=!0)})),t(),l();const c=document.querySelector(".attack-btn");document.querySelector(".next-turn").addEventListener("click",i),c.removeEventListener("click",o),0===s.gameboardObject.getShipLocations().length&&(t(),E())}},l=()=>{a(),r(),y(),m(),d(),p(),(()=>{const e=document.querySelector(".side-btns"),t=document.createElement("button");t.classList.add("attack-btn"),t.textContent="Attack!",e.appendChild(t)})(),(()=>{const e=document.querySelector(".side-btns"),t=document.createElement("button");t.classList.add("next-turn"),t.textContent="End Turn",e.appendChild(t)})(),document.querySelector(".attack-btn").addEventListener("click",o),document.querySelectorAll(".square").forEach((e=>{e.addEventListener("click",f)}))},u=a=>{a.currentTarget,a.stopPropagation(),!0===e.ships.every((e=>e.placed))&&(e.getName()===n.getPlayer1().getName()?(t(),e=n.changeCurrentPlayer(),v()):(t(),e=n.changeCurrentPlayer(),l()))},p=()=>{const e=document.querySelector(".monitor"),t=document.createElement("div");t.classList.add("side-btns"),e.appendChild(t)},h=t=>{const a=t.currentTarget;return t.stopPropagation(),document.querySelectorAll(".ship").forEach((e=>{"true"===e.dataset.active&&(e.dataset.active="false",e.lastChild.classList.add("hidden"))})),"false"===a.dataset.active?(a.dataset.active="true",a.lastChild.classList.remove("hidden"),e.selectShip(a.dataset.index)):(a.dataset.active="false",!1)},m=()=>{const t=e.blankGameboard,a=document.createElement("div"),c=document.querySelector(".monitor");a.classList.add("gameboard"),t.forEach((e=>{const c=e,n=document.createElement("div");n.classList.add("square"),n.textContent=c.cord,n.dataset.index=t.indexOf(e),n.dataset.isAttacked=c.isAttacked,n.dataset.isOccupied=c.isOccupied,n.dataset.isMissed=c.isMissed,n.dataset.active="false",a.appendChild(n)})),c.appendChild(a)},g=()=>{const t=e.playersGameboard,a=document.createElement("div"),c=document.querySelector(".monitor");a.classList.add("gameboard"),t.forEach((e=>{const c=e,n=document.createElement("div");n.classList.add("square"),n.textContent=c.cord,n.dataset.index=t.indexOf(e),n.dataset.isAttacked=c.isAttacked,n.dataset.isOccupied=c.isOccupied,n.dataset.active="false",a.appendChild(n)})),c.appendChild(a)},y=()=>{const e=document.createElement("div");e.classList.add("monitor"),c.appendChild(e)},f=e=>{const t=e.currentTarget;document.querySelectorAll(".square").forEach((e=>{"true"===e.dataset.active&&(e.dataset.active="false")})),"false"===t.dataset.active&&(t.dataset.active="true")},S=t=>{const a=t.currentTarget;return t.stopPropagation(),document.querySelectorAll(".direction").forEach((e=>{"true"===e.dataset.active&&(e.dataset.active="false")})),"false"===a.dataset.active?(a.dataset.active="true",e.selectDirection(a.id)):(a.dataset.active="false",!1)},v=()=>{a(),r(),y(),g(),d(),(()=>{const e=document.createElement("div");e.classList.add("controller");const t=document.createElement("div");t.classList.add("controls");const a=document.createElement("h2");a.textContent="Select orientation of ship",e.appendChild(a);const c=document.createElement("button");c.textContent="Up",c.classList.add("direction"),c.setAttribute("id","up"),c.dataset.active="false";const n=document.createElement("button");n.textContent="Down",n.classList.add("direction"),n.setAttribute("id","down"),n.dataset.active="false";const r=document.createElement("button");r.textContent="Right",r.classList.add("direction"),r.setAttribute("id","right"),r.dataset.active="false";const s=document.createElement("button");s.textContent="Left",s.classList.add("direction"),s.setAttribute("id","left"),s.dataset.active="false",document.querySelector(".monitor").appendChild(e),e.appendChild(t),t.appendChild(c),t.appendChild(n),t.appendChild(r),t.appendChild(s)})(),p(),(()=>{const e=document.createElement("button");e.classList.add("end-placement"),e.textContent="End Turn";const t=document.querySelector(".monitor"),a=document.querySelector(".side-btns");t.appendChild(a),a.appendChild(e)})(),document.querySelectorAll(".ship").forEach((e=>{e.addEventListener("click",h)})),document.querySelectorAll(".direction").forEach((e=>{e.addEventListener("click",S)})),document.querySelectorAll(".square").forEach((e=>{e.addEventListener("click",f)})),document.querySelectorAll(".place-ship").forEach((e=>{e.addEventListener("click",s)})),document.querySelector(".end-placement").addEventListener("click",u)},C=e=>{const a=document.querySelector(".gameboard");"false"===e.target.dataset.active&&(a.classList.remove("hidden"),e.target.dataset.active="true",e.target.classList.add("hidden"),t(),v())},b=n=>{const s=n.target;"false"===s.dataset.active&&(s.dataset.active="true",t(),a(),r(),y(),g(),(()=>{const t=document.createElement("button");t.classList.add("player-start"),t.textContent=`${e.getName()} Start!`,t.dataset.active="false",c.appendChild(t)})(),document.querySelector(".player-start").addEventListener("click",C))},E=()=>{a(),r(),(()=>{const e=document.createElement("button");e.classList.add("start"),e.textContent="Start",e.dataset.active=!1,c.appendChild(e)})(),document.querySelector(".start").addEventListener("click",b)};return{displayHome:E}})().displayHome()})();